---
// SimpleNavbar.astro - Enhanced WCAG/ARIA/AODA compliant navigation
import theme from '../../lib/theme.js';

export interface Props {
  currentPath?: string;
  logo?: {
    src?: string;
    alt?: string;
    text?: string;
  };
  links?: Array<{
    href: string;
    label: string;
    external?: boolean;
    submenu?: Array<{
      href: string;
      label: string;
      external?: boolean;
    }>;
  }>;
  ctaButton?: {
    href: string;
    label: string;
    external?: boolean;
  };
}

const {
  currentPath = '',
  logo = { text: 'Your Company', src: '/logo.svg' },
  links = [
    { href: '/', label: 'Home' },
    { 
      href: '/services', 
      label: 'Services',
      submenu: [
        { href: '/services/web-design', label: 'Web Design' },
        { href: '/services/consulting', label: 'Consulting' }
      ]
    },
    { href: '/about', label: 'About' },
    { href: '/contact', label: 'Contact' }
  ],
  ctaButton = { href: '/contact', label: 'Get Started' }
} = Astro.props;

// Check if current page matches link
const isActive = (href: string) => {
  if (href === '/' && currentPath === '/') return true;
  if (href !== '/' && currentPath.startsWith(href)) return true;
  return false;
};
---

<nav class="navbar" aria-label="Main navigation">
  <div class="navbar-container">
    <!-- Logo -->
    <a href="/" class="logo" aria-label="Go to homepage">
      {logo.src && (
        <img src={logo.src} alt={logo.alt || 'Company logo'} class="logo-img" />
      )}
      {logo.text && <span class="logo-text">{logo.text}</span>}
    </a>

    <!-- Desktop Navigation -->
    <ul class="nav-links desktop-nav">
      {links.map((link) => (
        <li class="nav-item">
          {link.submenu ? (
            <!-- Dropdown -->
            <div class="dropdown">
              <button 
                class={`nav-link dropdown-toggle ${isActive(link.href) ? 'active' : ''}`}
                aria-expanded="false"
                aria-haspopup="true"
              >
                {link.label}
                <svg class="dropdown-arrow" width="12" height="12" aria-hidden="true">
                  <path d="M6 8.5L2.5 5h7L6 8.5z" fill="currentColor"/>
                </svg>
              </button>
              <ul class="dropdown-menu">
                {link.submenu.map((subLink) => (
                  <li>
                    <a 
                      href={subLink.href}
                      class={`dropdown-link ${isActive(subLink.href) ? 'active' : ''}`}
                      {...(subLink.external && { 
                        target: '_blank', 
                        rel: 'noopener noreferrer' 
                      })}
                    >
                      {subLink.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ) : (
            <!-- Regular Link -->
            <a 
              href={link.href}
              class={`nav-link ${isActive(link.href) ? 'active' : ''}`}
              aria-current={isActive(link.href) ? 'page' : undefined}
              {...(link.external && { 
                target: '_blank', 
                rel: 'noopener noreferrer' 
              })}
            >
              {link.label}
            </a>
          )}
        </li>
      ))}
    </ul>

    <!-- CTA Button -->
    {ctaButton && (
      <a 
        href={ctaButton.href}
        class="cta-button desktop-nav"
        {...(ctaButton.external && { 
          target: '_blank', 
          rel: 'noopener noreferrer' 
        })}
      >
        {ctaButton.label}
      </a>
    )}

    <!-- Mobile Menu Button -->
    <button 
      class="mobile-menu-btn mobile-nav" 
      aria-expanded="false"
      aria-controls="mobile-menu"
      aria-label="Open navigation menu"
    >
      <span class="hamburger"></span>
      <span class="hamburger"></span>
      <span class="hamburger"></span>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu mobile-nav" id="mobile-menu" aria-hidden="true">
    <div class="mobile-menu-container">
      <ul class="mobile-nav-links">
        {links.map((link) => (
          <li class="mobile-nav-item">
            {link.submenu ? (
              <!-- Mobile Dropdown -->
              <div class="mobile-dropdown">
                <button 
                  class={`mobile-nav-link mobile-dropdown-toggle ${isActive(link.href) ? 'active' : ''}`}
                  aria-expanded="false"
                >
                  {link.label}
                  <svg class="mobile-dropdown-arrow" width="16" height="16" aria-hidden="true">
                    <path d="M8 11L4 7h8l-4 4z" fill="currentColor"/>
                  </svg>
                </button>
                <ul class="mobile-dropdown-menu">
                  {link.submenu.map((subLink) => (
                    <li>
                      <a 
                        href={subLink.href}
                        class={`mobile-dropdown-link ${isActive(subLink.href) ? 'active' : ''}`}
                        {...(subLink.external && { 
                          target: '_blank', 
                          rel: 'noopener noreferrer' 
                        })}
                      >
                        {subLink.label}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ) : (
              <!-- Regular Mobile Link -->
              <a 
                href={link.href}
                class={`mobile-nav-link ${isActive(link.href) ? 'active' : ''}`}
                aria-current={isActive(link.href) ? 'page' : undefined}
                {...(link.external && { 
                  target: '_blank', 
                  rel: 'noopener noreferrer' 
                })}
              >
                {link.label}
              </a>
            )}
          </li>
        ))}
        
        {ctaButton && (
          <li class="mobile-nav-item">
            <a 
              href={ctaButton.href}
              class="mobile-cta-button"
              {...(ctaButton.external && { 
                target: '_blank', 
                rel: 'noopener noreferrer' 
              })}
            >
              {ctaButton.label}
            </a>
          </li>
        )}
      </ul>
    </div>
  </div>
</nav>

<style define:vars={{
  // Colors from theme
  primaryColor: theme.colors.primary[500],
  primaryHover: theme.colors.primary[600],
  primaryLight: theme.colors.primary[100],
  neutralWhite: theme.colors.neutral[50],
  neutralGray: theme.colors.neutral[500],
  neutralLight: theme.colors.neutral[100],
  neutralDark: theme.colors.neutral[900],
  borderColor: theme.colors.border,
  backgroundColor: theme.colors.background,
  foregroundColor: theme.colors.foreground,
  mutedColor: theme.colors.muted,
  
  // Typography from theme
  fontSans: theme.typography.fontFamily.sans.join(', '),
  fontDisplay: theme.typography.fontFamily.display.join(', '),
  
  // Spacing from theme
  spacing1: theme.spacing[1],
  spacing2: theme.spacing[2],
  spacing3: theme.spacing[3],
  spacing4: theme.spacing[4],
  spacing5: theme.spacing[5],
  spacing6: theme.spacing[6],
  spacing8: theme.spacing[8],
  spacing11: theme.spacing[11], // 44px for touch targets
  spacing12: theme.spacing[12], // 48px for enhanced touch targets
  spacing16: theme.spacing[16],
  spacing20: theme.spacing[20],
  
  // Border radius from theme
  borderRadiusSm: theme.borderRadius.sm,
  borderRadiusBase: theme.borderRadius.base,
  borderRadiusLg: theme.borderRadius.lg,
  borderRadiusXl: theme.borderRadius.xl,
  
  // Shadows from theme
  shadowSm: theme.boxShadow.sm,
  shadowBase: theme.boxShadow.base,
  shadowMd: theme.boxShadow.md,
  shadowLg: theme.boxShadow.lg,
  
  // Animation from theme
  durationFast: theme.animation.duration.fast,
  durationNormal: theme.animation.duration.normal,
  easingOut: theme.animation.easing.out,
  
  // Component specific from theme
  navbarHeight: theme.components.navbar.height,
  mobileNavbarHeight: theme.components.navbar.mobileHeight,
  
  // Z-index from theme
  zIndexSkipLink: theme.zIndex.skipLink,
  zIndexSticky: theme.zIndex.sticky,
  zIndexDropdown: theme.zIndex.dropdown,
  zIndexModal: theme.zIndex.modal
}}>
  /* Main navbar */
  .navbar {
    background: rgba(255, 255, 255, 0.95);
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    position: sticky;
    top: 0;
    z-index: var(--zIndexSticky);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    transition: all var(--durationNormal) var(--easingOut);
  }

  .navbar:hover {
    background: rgba(255, 255, 255, 0.98);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .navbar-container {
    
    margin: 0 auto;
    padding: 0 var(--spacing6);
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: var(--mobileNavbarHeight);
    position: relative;
  }

  @media (min-width: 768px) {
    .navbar-container {
      height: var(--navbarHeight);
      padding: 0 var(--spacing8);
    }
  }

  /* Logo - Enhanced styling */
  .logo {
    display: flex;
    align-items: center;
    gap: var(--spacing3);
    text-decoration: none;
    color: var(--foregroundColor);
    font-family: var(--fontDisplay);
    font-weight: 800;
    font-size: 1.375rem;
    padding: var(--spacing3) var(--spacing4);
    border-radius: var(--borderRadiusXl);
    min-height: var(--spacing11);
    touch-action: manipulation;
    transition: all var(--durationNormal) var(--easingOut);
    position: relative;
    overflow: hidden;
  }

  .logo::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.5s ease;
  }

  .logo:hover::before {
    left: 100%;
  }

  .logo:focus {
    outline: 2px solid var(--primaryColor);
    outline-offset: 2px;
  }

  .logo:hover {
    transform: translateY(-1px);
    color: var(--primaryColor);
  }

  .logo-img {
    height: var(--spacing8);
    width: auto;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    transition: all var(--durationNormal) var(--easingOut);
  }

  .logo:hover .logo-img {
    transform: scale(1.05);
  }

  .logo-text {
    background: linear-gradient(135deg, var(--foregroundColor), var(--primaryColor));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    transition: all var(--durationNormal) var(--easingOut);
  }

  /* Desktop Navigation - Enhanced */
  .nav-links {
    display: flex;
    align-items: center;
    gap: var(--spacing1);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav-item {
    position: relative;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: var(--spacing2);
    text-decoration: none;
    color: var(--neutralGray);
    font-family: var(--fontSans);
    font-weight: 600;
    font-size: 0.9375rem;
    padding: var(--spacing3) var(--spacing5);
    border-radius: var(--borderRadiusXl);
    transition: all var(--durationNormal) var(--easingOut);
    background: none;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    min-height: var(--spacing11);
    touch-action: manipulation;
    position: relative;
    overflow: hidden;
  }

  .nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 100%;
    background: linear-gradient(135deg, var(--primaryColor), var(--primaryHover));
    border-radius: var(--borderRadiusXl);
    transition: width 0.3s var(--easingOut);
    z-index: -1;
  }

  .nav-link:hover::before,
  .nav-link:focus::before {
    width: 100%;
  }

  .nav-link:hover,
  .nav-link:focus {
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(175, 233, 14, 0.3);
  }

  .nav-link:focus {
    outline: 2px solid var(--primaryColor);
    outline-offset: 2px;
  }

  .nav-link.active {
    color: var(--primaryColor);
    background: rgba(175, 233, 14, 0.15);
    font-weight: 700;
    border: 1px solid rgba(175, 233, 14, 0.3);
  }

  .nav-link.active::before {
    width: 0;
  }

  /* Dropdown - Enhanced */
  .dropdown {
    position: relative;
  }

  .dropdown-arrow {
    transition: transform var(--durationNormal) var(--easingOut);
    flex-shrink: 0;
    opacity: 0.7;
  }

  .dropdown:hover .dropdown-arrow,
  .dropdown-toggle[aria-expanded="true"] .dropdown-arrow {
    transform: rotate(180deg);
    opacity: 1;
  }

  .dropdown-menu {
    position: absolute;
    top: calc(100% + var(--spacing3));
    left: 0;
    min-width: 220px;
    background: rgba(255, 255, 255, 0.98);
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: var(--borderRadiusXl);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12), 0 4px 6px rgba(0, 0, 0, 0.05);
    list-style: none;
    margin: 0;
    padding: var(--spacing3);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-15px) scale(0.95);
    transition: all var(--durationNormal) var(--easingOut);
    z-index: var(--zIndexDropdown);
    backdrop-filter: blur(20px);
  }

  .dropdown:hover .dropdown-menu,
  .dropdown-toggle[aria-expanded="true"] + .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
  }

  .dropdown-link {
    display: block;
    padding: var(--spacing3) var(--spacing4);
    text-decoration: none;
    color: var(--neutralGray);
    font-family: var(--fontSans);
    font-weight: 500;
    transition: all var(--durationNormal) var(--easingOut);
    min-height: var(--spacing11);
    touch-action: manipulation;
    border-radius: var(--borderRadiusLg);
    position: relative;
    overflow: hidden;
  }

  .dropdown-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primaryColor), var(--primaryHover));
    transition: left 0.3s var(--easingOut);
    z-index: -1;
  }

  .dropdown-link:hover::before,
  .dropdown-link:focus::before {
    left: 0;
  }

  .dropdown-link:hover,
  .dropdown-link:focus {
    color: white;
    transform: translateX(4px);
  }

  .dropdown-link:focus {
    outline: 2px solid var(--primaryColor);
    outline-offset: -2px;
  }

  .dropdown-link.active {
    color: var(--primaryColor);
    background: rgba(175, 233, 14, 0.15);
    font-weight: 600;
  }

  /* CTA Button - Enhanced */
  .cta-button {
    background: linear-gradient(135deg, var(--primaryColor), var(--primaryHover));
    color: var(--neutralDark);
    text-decoration: none;
    padding: var(--spacing3) var(--spacing6);
    border-radius: var(--borderRadiusXl);
    font-family: var(--fontSans);
    font-weight: 700;
    font-size: 0.9375rem;
    transition: all var(--durationNormal) var(--easingOut);
    border: 2px solid transparent;
    min-height: var(--spacing11);
    display: flex;
    align-items: center;
    touch-action: manipulation;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 14px rgba(175, 233, 14, 0.25);
  }

  .cta-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primaryHover), var(--primaryColor));
    opacity: 0;
    transition: opacity 0.3s var(--easingOut);
  }

  .cta-button:hover::before,
  .cta-button:focus::before {
    opacity: 1;
  }

  .cta-button:hover,
  .cta-button:focus {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(175, 233, 14, 0.4);
  }

  .cta-button:focus {
    outline: 2px solid var(--primaryColor);
    outline-offset: 2px;
  }

  .cta-button span {
    position: relative;
    z-index: 1;
  }

  /* Mobile Menu Button - Enhanced */
  .mobile-menu-btn {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(175, 233, 14, 0.2);
    cursor: pointer;
    padding: var(--spacing3);
    border-radius: var(--borderRadiusXl);
    transition: all var(--durationNormal) var(--easingOut);
    min-width: var(--spacing12);
    min-height: var(--spacing12);
    touch-action: manipulation;
    position: relative;
    overflow: hidden;
  }

  .mobile-menu-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primaryColor), var(--primaryHover));
    opacity: 0;
    transition: opacity 0.3s var(--easingOut);
  }

  .mobile-menu-btn:hover::before,
  .mobile-menu-btn:focus::before {
    opacity: 0.1;
  }

  .mobile-menu-btn:hover,
  .mobile-menu-btn:focus {
    border-color: var(--primaryColor);
    transform: scale(1.05);
  }

  .mobile-menu-btn:focus {
    outline: 2px solid var(--primaryColor);
    outline-offset: 2px;
  }

  .hamburger {
    display: block;
    width: var(--spacing6);
    height: 3px;
    background: var(--foregroundColor);
    transition: all 0.3s var(--easingOut);
    border-radius: 2px;
    margin: 2px 0;
    position: relative;
    z-index: 1;
  }

  .mobile-menu-btn[aria-expanded="true"] .hamburger:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }

  .mobile-menu-btn[aria-expanded="true"] .hamburger:nth-child(2) {
    opacity: 0;
  }

  .mobile-menu-btn[aria-expanded="true"] .hamburger:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -6px);
  }

  /* Mobile Menu - Enhanced */
  .mobile-menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    max-height: 0;
    overflow: hidden;
    transition: all 0.4s var(--easingOut);
    z-index: var(--zIndexModal);
  }

  .mobile-menu[aria-hidden="false"] {
    max-height: 100vh;
  }

  .mobile-menu-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 var(--spacing6);
  }

  .mobile-nav-links {
    list-style: none;
    margin: 0;
    padding: var(--spacing6) 0;
  }

  .mobile-nav-item {
    margin-bottom: var(--spacing3);
  }

  .mobile-nav-item:last-child {
    margin-bottom: 0;
  }

  .mobile-nav-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    text-decoration: none;
    color: var(--foregroundColor);
    font-family: var(--fontSans);
    font-size: 1.125rem;
    font-weight: 600;
    padding: var(--spacing4) var(--spacing5);
    border-radius: var(--borderRadiusXl);
    transition: all var(--durationNormal) var(--easingOut);
    background: none;
    border: 2px solid transparent;
    cursor: pointer;
    width: 100%;
    text-align: left;
    min-height: var(--spacing12);
    touch-action: manipulation;
    position: relative;
    overflow: hidden;
  }

  .mobile-nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primaryColor), var(--primaryHover));
    transition: left 0.3s var(--easingOut);
    z-index: -1;
  }

  .mobile-nav-link:hover::before,
  .mobile-nav-link:focus::before {
    left: 0;
  }

  .mobile-nav-link:hover,
  .mobile-nav-link:focus {
    color: white;
    border-color: var(--primaryColor);
    transform: translateX(8px);
  }

  .mobile-nav-link:focus {
    outline: 2px solid var(--primaryColor);
    outline-offset: 2px;
  }

  .mobile-nav-link.active {
    color: var(--primaryColor);
    background: rgba(175, 233, 14, 0.15);
    border-color: var(--primaryColor);
    font-weight: 700;
  }

  .mobile-nav-link.active::before {
    left: -100%;
  }

  /* Mobile Dropdown - Enhanced */
  .mobile-dropdown-arrow {
    transition: transform var(--durationNormal) var(--easingOut);
    flex-shrink: 0;
    opacity: 0.7;
  }

  .mobile-dropdown-toggle[aria-expanded="true"] .mobile-dropdown-arrow {
    transform: rotate(180deg);
    opacity: 1;
  }

  .mobile-dropdown-menu {
    list-style: none;
    margin: 0;
    padding: 0;
    margin-left: var(--spacing6);
    max-height: 0;
    overflow: hidden;
    transition: all 0.4s var(--easingOut);
  }

  .mobile-dropdown-toggle[aria-expanded="true"] + .mobile-dropdown-menu {
    max-height: 500px;
    margin-top: var(--spacing3);
  }

  .mobile-dropdown-link {
    display: block;
    text-decoration: none;
    color: var(--neutralGray);
    font-family: var(--fontSans);
    font-weight: 500;
    padding: var(--spacing3) var(--spacing4);
    border-radius: var(--borderRadiusLg);
    transition: all var(--durationNormal) var(--easingOut);
    margin-bottom: var(--spacing2);
    border: 2px solid transparent;
    min-height: var(--spacing11);
    touch-action: manipulation;
    position: relative;
    overflow: hidden;
  }

  .mobile-dropdown-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primaryColor), var(--primaryHover));
    transition: left 0.3s var(--easingOut);
    z-index: -1;
  }

  .mobile-dropdown-link:hover::before,
  .mobile-dropdown-link:focus::before {
    left: 0;
  }

  .mobile-dropdown-link:hover,
  .mobile-dropdown-link:focus {
    color: white;
    border-color: var(--primaryColor);
    transform: translateX(6px);
  }

  .mobile-dropdown-link:focus {
    outline: 2px solid var(--primaryColor);
    outline-offset: 2px;
  }

  .mobile-dropdown-link.active {
    color: var(--primaryColor);
    background: rgba(175, 233, 14, 0.15);
    border-color: var(--primaryColor);
    font-weight: 600;
  }

  /* Mobile CTA - Enhanced */
  .mobile-cta-button:focus {
    outline: 2px solid var(--primaryColor);
    outline-offset: 2px;
  }

  .mobile-cta-button span {
    position: relative;
    z-index: 1;
  }

  /* Responsive utilities */
  .desktop-nav {
    display: none;
  }

  .mobile-nav {
    display: block;
  }

  @media (min-width: 768px) {
    .desktop-nav {
      display: flex;
    }

    .mobile-nav {
      display: none;
    }
  }

  /* Enhanced animations and micro-interactions */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes shimmer {
    0% {
      background-position: -200% 0;
    }
    100% {
      background-position: 200% 0;
    }
  }

  .nav-item:nth-child(1) { animation-delay: 0.1s; }
  .nav-item:nth-child(2) { animation-delay: 0.2s; }
  .nav-item:nth-child(3) { animation-delay: 0.3s; }
  .nav-item:nth-child(4) { animation-delay: 0.4s; }
  .nav-item:nth-child(5) { animation-delay: 0.5s; }

  /* Dark mode support */
  @media (prefers-color-scheme: dark) {
    .navbar {
      background: rgba(17, 24, 39, 0.95);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    .navbar:hover {
      background: rgba(17, 24, 39, 0.98);
    }

    .mobile-menu {
      background: rgba(17, 24, 39, 0.98);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    .dropdown-menu {
      background: rgba(17, 24, 39, 0.98);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .mobile-menu-btn {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(175, 233, 14, 0.3);
    }
  }

  /* High contrast support */
  @media (prefers-contrast: high) {
    .navbar {
      border-bottom-width: 2px;
      background: white;
      backdrop-filter: none;
    }
    
    .nav-link,
    .mobile-nav-link,
    .dropdown-link,
    .mobile-dropdown-link,
    .logo,
    .cta-button,
    .mobile-cta-button,
    .mobile-menu-btn {
      border-width: 2px;
    }
    
    .nav-link:focus,
    .mobile-nav-link:focus,
    .dropdown-link:focus,
    .mobile-dropdown-link:focus,
    .logo:focus,
    .cta-button:focus,
    .mobile-cta-button:focus,
    .mobile-menu-btn:focus {
      outline-width: 3px;
    }

    .dropdown-menu,
    .mobile-menu {
      backdrop-filter: none;
      background: white;
      border-width: 2px;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
    
    .dropdown-menu,
    .mobile-menu,
    .mobile-dropdown-menu {
      transition: none;
    }

    .nav-link::before,
    .dropdown-link::before,
    .mobile-nav-link::before,
    .mobile-dropdown-link::before,
    .cta-button::before,
    .mobile-cta-button::before,
    .mobile-menu-btn::before,
    .logo::before {
      display: none;
    }
  }

  /* Print styles */
  @media print {
    .navbar {
      position: static;
      background: white !important;
      border-bottom: 2px solid black;
      backdrop-filter: none;
      box-shadow: none;
    }
    
    .mobile-menu,
    .dropdown-menu,
    .mobile-menu-btn,
    .cta-button,
    .mobile-cta-button {
      display: none !important;
    }
    
    .nav-links {
      display: flex !important;
      flex-wrap: wrap;
    }
    
    .nav-link {
      color: black !important;
      text-decoration: underline;
      background: none !important;
      border: none !important;
    }

    .logo {
      color: black !important;
    }

    .logo-text {
      -webkit-text-fill-color: black !important;
      background: none !important;
    }
  }

  /* Focus visible for better keyboard navigation */
  .nav-link:focus-visible,
  .mobile-nav-link:focus-visible,
  .dropdown-link:focus-visible,
  .mobile-dropdown-link:focus-visible,
  .logo:focus-visible,
  .cta-button:focus-visible,
  .mobile-cta-button:focus-visible,
  .mobile-menu-btn:focus-visible {
    outline: 3px solid var(--primaryColor);
    outline-offset: 2px;
  }

  /* Enhanced loading states */
  .navbar.loading {
    opacity: 0.7;
    pointer-events: none;
  }

  .navbar.loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(175, 233, 14, 0.1), transparent);
    animation: shimmer 2s infinite;
    background-size: 200% 100%;
  }

  /* Smooth scroll behavior for anchor links */
  html {
    scroll-behavior: smooth;
  }

  /* Enhanced mobile menu container */
  @media (max-width: 767px) {
    .mobile-menu-container {
      padding: 0 var(--spacing4);
    }

    .navbar-container {
      padding: 0 var(--spacing4);
    }
  }

  /* Ultra-wide screen support */
  @media (min-width: 1536px) {
    .navbar-container,
    .mobile-menu-container {
      padding: 0 var(--spacing12);
    }
  }
</style>

<script>
  class SimpleNavbar {
    constructor() {
      this.mobileMenuBtn = document.querySelector('.mobile-menu-btn');
      this.mobileMenu = document.querySelector('.mobile-menu');
      this.dropdownToggles = document.querySelectorAll('.dropdown-toggle');
      this.mobileDropdownToggles = document.querySelectorAll('.mobile-dropdown-toggle');
      this.navbar = document.querySelector('.navbar');
      
      this.init();
    }

    init() {
      // Add loading class initially
      this.navbar?.classList.add('loading');
      
      // Remove loading class after initialization
      setTimeout(() => {
        this.navbar?.classList.remove('loading');
      }, 100);

      // Mobile menu toggle
      if (this.mobileMenuBtn && this.mobileMenu) {
        this.mobileMenuBtn.addEventListener('click', () => {
          this.toggleMobileMenu();
        });
        
        // Close on escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.mobileMenu.getAttribute('aria-hidden') === 'false') {
            this.closeMobileMenu();
          }
        });
        
        // Close mobile menu on window resize to desktop
        window.addEventListener('resize', () => {
          if (window.innerWidth >= 768 && this.mobileMenu.getAttribute('aria-hidden') === 'false') {
            this.closeMobileMenu();
          }
        });

        // Prevent scroll when mobile menu is open
        const mediaQuery = window.matchMedia('(max-width: 767px)');
        mediaQuery.addListener(() => {
          if (!mediaQuery.matches && this.mobileMenu.getAttribute('aria-hidden') === 'false') {
            this.closeMobileMenu();
          }
        });
      }

      // Desktop dropdowns with enhanced interactions
      this.dropdownToggles.forEach(toggle => {
        const dropdown = toggle.closest('.dropdown');
        const menu = toggle.nextElementSibling;
        let hoverTimeout;

        // Mouse events with delays for better UX
        dropdown.addEventListener('mouseenter', () => {
          clearTimeout(hoverTimeout);
          this.openDropdown(toggle, menu);
        });

        dropdown.addEventListener('mouseleave', () => {
          hoverTimeout = setTimeout(() => {
            this.closeDropdown(toggle, menu);
          }, 150); // Small delay to prevent accidental closes
        });

        // Keyboard events
        toggle.addEventListener('click', (e) => {
          e.preventDefault();
          this.toggleDropdown(toggle, menu);
        });

        toggle.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.toggleDropdown(toggle, menu);
          } else if (e.key === 'Escape') {
            this.closeDropdown(toggle, menu);
            toggle.focus();
          } else if (e.key === 'ArrowDown') {
            e.preventDefault();
            this.openDropdown(toggle, menu);
            const firstLink = menu.querySelector('.dropdown-link');
            if (firstLink) firstLink.focus();
          }
        });

        // Enhanced keyboard navigation within dropdown
        menu.addEventListener('keydown', (e) => {
          const links = menu.querySelectorAll('.dropdown-link');
          const currentIndex = Array.from(links).indexOf(document.activeElement);

          if (e.key === 'ArrowDown') {
            e.preventDefault();
            const nextIndex = (currentIndex + 1) % links.length;
            links[nextIndex].focus();
          } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            const prevIndex = currentIndex > 0 ? currentIndex - 1 : links.length - 1;
            links[prevIndex].focus();
          } else if (e.key === 'Escape') {
            this.closeDropdown(toggle, menu);
            toggle.focus();
          }
        });
      });

      // Mobile dropdowns
      this.mobileDropdownToggles.forEach(toggle => {
        const menu = toggle.nextElementSibling;

        toggle.addEventListener('click', () => {
          this.toggleMobileDropdown(toggle, menu);
        });

        toggle.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.toggleMobileDropdown(toggle, menu);
          }
        });
      });

      // Close dropdowns when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.dropdown')) {
          this.closeAllDropdowns();
        }
      });

      // Enhanced scroll behavior
      let lastScrollY = window.scrollY;
      window.addEventListener('scroll', () => {
        const currentScrollY = window.scrollY;
        
        // Add/remove scrolled class for styling
        if (currentScrollY > 20) {
          this.navbar?.classList.add('scrolled');
        } else {
          this.navbar?.classList.remove('scrolled');
        }

        lastScrollY = currentScrollY;
      }, { passive: true });
      
      // Announce navigation state changes to screen readers
      this.setupScreenReaderAnnouncements();

      // Add stagger animation to nav items
      this.addStaggerAnimation();
    }

    addStaggerAnimation() {
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach((item, index) => {
        item.style.animationDelay = `${index * 0.1}s`;
      });
    }

    toggleMobileMenu() {
      const isOpen = this.mobileMenu.getAttribute('aria-hidden') === 'false';
      
      if (isOpen) {
        this.closeMobileMenu();
      } else {
        this.openMobileMenu();
      }
    }

    openMobileMenu() {
      this.mobileMenuBtn.setAttribute('aria-expanded', 'true');
      this.mobileMenuBtn.setAttribute('aria-label', 'Close navigation menu');
      this.mobileMenu.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
      
      // Add animation class
      this.mobileMenu.classList.add('opening');
      setTimeout(() => {
        this.mobileMenu.classList.remove('opening');
      }, 400);
      
      this.announceToScreenReader('Navigation menu opened');
    }

    closeMobileMenu() {
      this.mobileMenuBtn.setAttribute('aria-expanded', 'false');
      this.mobileMenuBtn.setAttribute('aria-label', 'Open navigation menu');
      this.mobileMenu.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
      
      // Close all mobile dropdowns when closing menu
      this.mobileDropdownToggles.forEach(toggle => {
        toggle.setAttribute('aria-expanded', 'false');
      });
      
      this.announceToScreenReader('Navigation menu closed');
    }

    toggleDropdown(toggle, menu) {
      const isOpen = toggle.getAttribute('aria-expanded') === 'true';
      
      if (isOpen) {
        this.closeDropdown(toggle, menu);
      } else {
        this.closeAllDropdowns();
        this.openDropdown(toggle, menu);
      }
    }

    openDropdown(toggle, menu) {
      toggle.setAttribute('aria-expanded', 'true');
    }

    closeDropdown(toggle, menu) {
      toggle.setAttribute('aria-expanded', 'false');
    }

    closeAllDropdowns() {
      this.dropdownToggles.forEach(toggle => {
        toggle.setAttribute('aria-expanded', 'false');
      });
    }

    toggleMobileDropdown(toggle, menu) {
      const isOpen = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', !isOpen);
    }
    
    setupScreenReaderAnnouncements() {
      // Create live region for announcements
      if (!document.getElementById('nav-announcements')) {
        const liveRegion = document.createElement('div');
        liveRegion.id = 'nav-announcements';
        liveRegion.setAttribute('aria-live', 'polite');
        liveRegion.setAttribute('aria-atomic', 'true');
        liveRegion.style.position = 'absolute';
        liveRegion.style.left = '-10000px';
        liveRegion.style.width = '1px';
        liveRegion.style.height = '1px';
        liveRegion.style.overflow = 'hidden';
        document.body.appendChild(liveRegion);
      }
    }
    
    announceToScreenReader(message) {
      const liveRegion = document.getElementById('nav-announcements');
      if (liveRegion) {
        liveRegion.textContent = message;
        
        // Clear after announcement
        setTimeout(() => {
          liveRegion.textContent = '';
        }, 1000);
      }
    }
  }

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    try {
      new SimpleNavbar();
      
      // Mark as successfully loaded for debugging
      document.documentElement.classList.add('navbar-js-loaded');
      
    } catch (error) {
      console.error('Error initializing navbar:', error);
      
      // Provide basic fallback functionality
      const mobileBtn = document.querySelector('.mobile-menu-btn');
      const mobileMenu = document.querySelector('.mobile-menu');
      
      if (mobileBtn && mobileMenu) {
        mobileBtn.addEventListener('click', () => {
          const isHidden = mobileMenu.getAttribute('aria-hidden') === 'true';
          mobileMenu.setAttribute('aria-hidden', !isHidden);
          mobileBtn.setAttribute('aria-expanded', isHidden);
        });
      }
    }
  });

  // Handle page navigation cleanup
  window.addEventListener('beforeunload', () => {
    document.body.style.overflow = '';
  });

  // Enhanced utilities for external use
  window.NavbarUtils = {
    closeAllMenus: () => {
      const mobileMenu = document.querySelector('.mobile-menu');
      const mobileButton = document.querySelector('.mobile-menu-btn');
      
      if (mobileMenu && mobileButton) {
        mobileMenu.setAttribute('aria-hidden', 'true');
        mobileButton.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      }
      
      document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
        toggle.setAttribute('aria-expanded', 'false');
      });
    },
    
    announceToScreenReader: (message) => {
      const liveRegion = document.getElementById('nav-announcements');
      if (liveRegion) {
        liveRegion.textContent = message;
        setTimeout(() => liveRegion.textContent = '', 1000);
      }
    },

    toggleTheme: () => {
      document.documentElement.classList.toggle('dark-theme');
    },

    addCustomStyles: (styles) => {
      const styleSheet = document.createElement('style');
      styleSheet.textContent = styles;
      document.head.appendChild(styleSheet);
    }
  };
</script>